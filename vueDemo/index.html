<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">


    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14 " type="text/javascript" charset="utf-8">    </script>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link href="css/styled.css" rel="stylesheet">
</head>

<body>
    <div id="app">
        <input v-model="get.date" v-on:keyup.enter="Submit" placeholder="xxxx-xx-xx">
        <button v-on:click="Submit">Submit</button>

        <input v-model="get.team" v-on:keyup.enter="Submit" placeholder="">
        <button v-on:click="Submit">Search</button>

        <div class="contest-spinner" v-bind:style="{visibility: active}">
            <div class="spinner-border" style="width: 5rem; height: 5rem;" role="status">
                <span class="sr-only"></span>
            </div>
        </div>

        <div id="detial">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th>Competition</th>
                        <th>Time</th>
                        <th>Away team</th>
                        <th>Home team</th>
                        <th>Count</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="detial, index in detial">
                        <th scope="row"> {{detial.no}}</th>
                        <td>{{detial.type}}</td>
                        <td>{{detial.time}}</td>
                        <td>{{detial.away_team}}</td>
                        <td>{{detial.home_team}}</td>
                        <td>
                            <span :class="countHealth(detial.lose)">{{detial.lose}}</span> : <span
                                :class="countHealth(detial.win)">{{detial.win}}</span>
                        </td>
                    </tr>
                    <tr class="errorMsg">
                        <td v-if="errorMessage.active" colspan="6">
                            ERROR : <span class="text-danger">{{errorMessage.html}}</span>
                        </td>

                    </tr>
                </tbody>
            </table>
        </div>


    </div>

    <script type="text/javascript">
        var app = new Vue({
            el: '#app',
            data: {
                url: "http://127.0.0.1:8000/Max/api/db?",
                get: {
                    date: "2022-04-02",
                    team: "",
                },
                detial: [],
                active: "collapse",
                errorMessage: {
                    active: false,
                    html: ""
                }

            },
            //定義方法
            methods: {
                Submit: function (event) {


                    // let loader visible 
                    this.active = "visible"

                    this.errorMessage.active = false

                    // catch get_url parameter
                    var get = ""
                    for (key in this.get) {
                        get += '&' + key + "=" + this.get[key]
                    }

                    // get response with "http://127.0.0.1:8000/Max/api/db?"
                    axios.get(this.url + get).then(response => {

                        this.detial = response.data;
                        this.active = "collapse";


                    }).catch(error => {

                        this.active = "collapse"

                        this.detial = [];
                        this.errorMessage.active = true
                        this.errorMessage.html = error



                    })


                },

                //  show lose or win color red/blue
                countHealth: function (count) {

                    if (count > 2) {
                        return 'text-danger';
                    } else {
                        return 'text-primary';
                    }
                },


            },
        })
    </script>
</body>


</html>